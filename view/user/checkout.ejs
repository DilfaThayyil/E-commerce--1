<%-include('../partials/header')%>
<%-include('../partials/navbar')%>
<%-include('../partials/mobileNavbar')%>



    <div class="page-wrapper">
        <main class="main">
        	<div class="page-header text-center" style="background-image: url('assets/images/page-header-bg.jpg')">
        		<div class="container">
        			<h1 class="page-title">Checkout<span>Shop</span></h1>
        		</div><!-- End .container -->
        	</div><!-- End .page-header -->
            <nav aria-label="breadcrumb" class="breadcrumb-nav">
                <div class="container">
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item"><a href="index.html">Home</a></li>
                        <li class="breadcrumb-item"><a href="#">Shop</a></li>
                        <li class="breadcrumb-item active" aria-current="page">Checkout</li>
                    </ol>
                </div><!-- End .container -->
            </nav><!-- End .breadcrumb-nav -->

            <div class="page-content">
            	<div class="checkout">
	                <div class="container">
            			<div class="checkout-discount">
            				<form action="/" hidden>
        						<input type="text" class="form-control" required id="checkout-discount-input">
            					<label for="checkout-discount-input" class="text-truncate">Have a coupon? <span>Click here to enter your code</span></label>
            				</form>
            			</div><!-- End .checkout-discount -->
            			<form action="#">
		                	<div class="row">
		                		<div class="col-lg-9">
									<div class="container">
										<div class="row">
											<div class="col-md-3">
												<div class="card ">
													<div class="card-body">
														<h5>SELECT ADDRESS</h5>
														<%user.Addresses.forEach((address,index)=>{%>
														
														<div class="form-check mt-3">
															<input class="form-check-input" type="radio" name="selectedAddress" id="address<%= index %>" value="<%= index %>">
															<label class="form-check-label" for="address<%= index %>"></label>
														</div>	
														<h5 class="card-title">Address-<%=index+1%></h5>
														<ul class="list-group list-group-flush">
															<li class="list-group-item"><strong>Name:</strong> <%=address.name%></li>
															<li class="list-group-item"><strong>Email:</strong> <%=address.email%></li>
															<li class="list-group-item"><strong>Phone:</strong> <%=address.phone%></li>
															<li class="list-group-item"><strong>Address:</strong> <%=address.address%></li>
															<li class="list-group-item"><strong>Pincode:</strong> <%=address.pincode%></li>
															<li class="list-group-item"><strong>State:</strong> <%=address.state%></li>
															<li class="list-group-item"><strong>City</strong> <%=address.city%></li>
														</ul>
														
														<%})%>
													</div>
												</div>
											</div>
										  <form action="/placeOrder" method="POST">	
											<aside class="col-lg-6 col-md-4">
												<div class="summary">
													<h3 class="summary-title">Your Order</h3><!-- End .summary-title -->
			
													<table class="table table-summary">
														<thead>
															<tr>
																<th>Product</th>
																<th>Total</th>
															</tr>
														</thead>
			
														<tbody>
															<tr>
																<td><a href="#">Beige knitted elastic runner shoes</a></td>
																<td>$84.00</td>
															</tr>
			
															<tr>
																<td><a href="#">Blue utility pinafore denimdress</a></td>
																<td>$76,00</td>
															</tr>
															<tr class="summary-subtotal">
																<td>Subtotal:</td>
																<td>$160.00</td>
															</tr><!-- End .summary-subtotal -->
															<tr>
																<td>Shipping:</td>
																<td>Free shipping</td>
															</tr>
															<tr class="summary-total">
																<td>Total:</td>
																<td>$160.00</td>
															</tr><!-- End .summary-total -->
														</tbody>
													</table><!-- End .table table-summary -->
			
													<div class="accordion-summary" id="accordion-payment"> 
														<div class="card">
															<div class="card-header" id="heading-3">
																<h2 class="card-title">
																	<a class="collapsed" role="button" data-toggle="collapse" href="#collapse-3" aria-expanded="false" aria-controls="collapse-3">
																		Cash on delivery
																	</a>
																</h2>
															</div><!-- End .card-header -->
															<div id="collapse-3" class="collapse" aria-labelledby="heading-3" data-parent="#accordion-payment">
																<div class="card-body"> 
																</div><!-- End .card-body -->
															</div><!-- End .collapse -->
														</div><!-- End .card -->
													</div><!-- End .accordion -->
			
													<button type="submit" class="btn btn-outline-primary-2 btn-order btn-block">
														<span class="btn-text">Place Order</span>
														<span class="btn-hover-text">Proceed to Checkout</span>
													</button>
												</div><!-- End .summary -->
											</aside><!-- End .col-lg-3 -->
										  </form>	
										</div>
										<button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#exampleModal">
											Add new address
										</button>
									</div>
 
									<!-- Modal -->
		                		</div><!-- End .col-lg-9 -->
		                	</div><!-- End .row -->
            			</form>
						<div class="modal fade p-5" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
							<div class="modal-dialog ">
							  <div class="modal-content p-2">
								<div class="modal-header">
								  <h5 class="modal-title" id="exampleModalLabel">Add Your Address</h5>
								  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
								</div>
								<div class="modal-body p-5">
									<form id="addressForm" action="/addressSubmit" method="post">
										<div class="form-group">
											<label for="exampleInputName1">Your Name</label>
											<input type="text" class="form-control" id="name" placeholder="Enter Name" name="name">
										</div>
										<div class="form-group">
											<label for="exampleInputMobilenumber1">Mobile Number</label>
											<input type="text" class="form-control" id="phone" placeholder="Enter Mobile Number" name="phone">
										</div>
										<div class="form-group">
										  <label for="exampleInputEmail1">Email address</label>
										  <input type="email" class="form-control" id="email" placeholder="Enter Email" name="email">
										</div>
										<div class="form-group">
											<label for="exampleInputaddress1">Address</label>
											<input type="text" class="form-control" id="address" placeholder="Enter Address" name="address">
										</div>
										<div class="form-group">
											<label for="exampleInputpincode1">Pincode</label>
											<input type="text" class="form-control" id="pincode" placeholder="Enter Pincode" name="pincode">
										</div>
										<div class="form-group">
											<label for="exampleInputstate1">State</label>
											<input type="text" class="form-control" id="state" placeholder="Enter state" name="state">
										</div>
										<div class="form-group">
											<label for="exampleInputcity1">City</label>
											<input type="text" class="form-control" id="city" placeholder="Enter City" name="city">
										</div>
										<div class="modal-footer">
											<button type="submit" id="submitBtn" class="btn btn-primary">Submit</button>
										</div>
									</form>
								</div>
								
							  </div>
							</div>
						</div>
	                </div><!-- End .container -->
                </div><!-- End .checkout -->
            </div><!-- End .page-content -->
        </main><!-- End .main -->
    </div><!-- End .page-wrapper -->

    
<%-include('../partials/footer')%>
<%-include('../partials/footerbar')%>

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>

<script>
    document.getElementById('submitBtn').addEventListener('click', function(event) {
        event.preventDefault(); 

        
        Swal.fire({
            title: 'Are you sure?',
            text: 'Do you want to submit this address?',
            icon: 'question',
            showCancelButton: true,
            confirmButtonColor: '#3085d6',
            cancelButtonColor: '#d33',
            confirmButtonText: 'Yes, submit it!'


        }).then((result) => {
            if (result.isConfirmed) {
                document.getElementById('addressForm').submit();
            }
        });
    });


	document.addEventListener('DOMContentLoaded', function () {
    const form = document.getElementById('addressForm');

    form.addEventListener('submit', function (event) {
        const phoneInput = document.getElementById('phone');
        const pincodeInput = document.getElementById('pincode');

        const phoneRegex = /^\d{10}$/;
        const pincodeRegex = /^\d{6}$/;

        if (!phoneRegex.test(phoneInput.value)) {
            Swal.fire({
                icon: 'error',
                title: 'Invalid Input',
                text: 'Please enter a valid mobile number (10 digits without spaces or letters).',
            });
            event.preventDefault();
            return;
        }

        if (!pincodeRegex.test(pincodeInput.value)) {
            Swal.fire({
                icon: 'error',
                title: 'Invalid Input',
                text: 'Please enter a valid pincode (6 digits without spaces or letters).',
            });
            event.preventDefault();
            return;
        }


        const selectedAddressIndex = document.querySelector('input[name="selectedAddress"]:checked').value;
        const selectedAddress = user.Addresses[selectedAddressIndex];

        const orderData = {
            address: selectedAddress.address,
            city: selectedAddress.city,
            state: selectedAddress.state,
            pincode: selectedAddress.pincode,
        };

        console.log('Order Data:', orderData);

        fetch('/placeOrder', {
            method: 'POST',
            body: JSON.stringify(orderData),
            headers: {
                'Content-Type': 'application/json'
            }
        })
        .then(response => response.json())
        .then(data => {
        })
        .catch(error => {
            console.error('Error placing order:', error);
        });
		if(data.success){

			Swal.fire({
            icon: 'success',
            title: 'Order Placed!',
            text: 'Your order has been successfully placed.',
        });
		}
        
    });
});


</script>
